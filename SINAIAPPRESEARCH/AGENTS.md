# Repository Guidelines

## Project Structure & Module Organization
This monorepo uses npm workspaces. `apps/researcher-portal` hosts the Next.js dashboard; local routes live in `app/` and shared UI in `app/components`. `services/study-management` delivers the Express API with `src/` for handlers, `migrations/` for node-pg-migrate files, and `tests/contract/` for API smoke suites. Cross-cutting types, schemas, and Redis helpers belong in `packages/shared/src`. Feature briefs and automation templates reside in `specs/` and `templates/`, while data seeding lives under `scripts/`.

## Build, Test, and Development Commands
Install dependencies once at the root with `npm install`. Use `npm run dev --workspace apps/researcher-portal` for the dashboard and `npm run dev --workspace services/study-management` for the API. `npm run build --workspaces` compiles every package. Run `npm test` to execute the Jest suite across workspaces, `npm run lint --workspaces` to enforce style, and `npm run typecheck --workspaces` before merging. Manage schema changes with `npm run db:migrate` and hydrate sample data via `npm run db:seed`.

## Coding Style & Naming Conventions
All code is TypeScript. Prettier enforces two-space indentation, 100-character lines, single quotes, and trailing commas; run the formatter before commits. ESLint forbids `any`, unused variables, and stray `console.log`, so fix warnings locally. Prefer PascalCase for React components, camelCase for functions and variables, and kebab-case for directories. Published packages stay under the `@research-study/*` scope.

## Testing Guidelines
Jest with ts-jest is the shared harness, and the repository targets 80% coverage. Place new contract tests in `services/study-management/tests/contract` using the `*.test.ts` suffix; rely on `supertest` and shared factories for HTTP setup. Run `npm test -- --coverage` after touching APIs or shared utilities, and capture DOM snapshots when UI behavior changes.

## Commit & Pull Request Guidelines
Follow conventional commits (`feat:`, `fix:`, `chore:`) and keep branch names aligned with the three-digit spec prefix generated by `scripts/create-new-feature`. PRs must outline scope, list affected workspaces, link any spec in `specs/`, and mention required migrations or env changes. Confirm lint, test, and database commands in the checklist, adding UI screenshots whenever the dashboard shifts.

## Environment & Security Notes
Copy `.env.example` to `.env` for each service and keep secrets out of version control. Spin up Postgres and Redis with `docker-compose up -d` when collaborating. Remove protected health information from fixtures and rotate JWT or encryption keys immediately if exposed in logs.
